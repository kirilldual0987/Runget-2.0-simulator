<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runget 2.0 - Легкая, быстрая, простая и красивая ОС</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans', sans-serif;
            user-select: none;
        }

        :root {
            --plasma-bg: #1b1e20;
            --plasma-panel: #1a1d21;
            --plasma-surface: #232629;
            --plasma-surface-light: #2a2e32;
            --plasma-border: #3d4349;
            --plasma-accent: #3daee9;
            --plasma-accent-hover: #5bc2f5;
            --plasma-text: #eff0f1;
            --plasma-text-secondary: #bdc3c7;
            --plasma-success: #27ae60;
            --plasma-warning: #f39c12;
            --plasma-danger: #da4453;
            --window-header: #2d3136;
            --window-header-inactive: #252a2e;
        }

        body {
            overflow: hidden;
            background: var(--plasma-bg);
        }

        .logo-3d-r {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial Black', 'Segoe UI', sans-serif;
            font-weight: 900;
            color: #fff;
            background: linear-gradient(180deg, #5dade2 0%, #3daee9 30%, #2874a6 70%, #1a5276 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(3px 5px 8px rgba(0,0,0,0.5));
        }

        /* Boot Screen */
        #bootScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1a1d21 0%, #0d0f11 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .boot-logo {
            width: 140px;
            height: 140px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s ease-in-out infinite;
        }

        .boot-logo .logo-3d-r {
            font-size: 100px;
            filter: drop-shadow(4px 6px 10px rgba(61, 174, 233, 0.4));
        }

        .boot-text {
            color: var(--plasma-text);
            font-size: 32px;
            font-weight: 300;
            margin-bottom: 40px;
            letter-spacing: 3px;
        }

        .boot-spinner {
            width: 220px;
            height: 3px;
            background: var(--plasma-surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .boot-spinner-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--plasma-accent), #5bc2f5);
            width: 0%;
            transition: width 0.1s;
            border-radius: 3px;
        }

        .boot-status {
            color: var(--plasma-text-secondary);
            font-size: 12px;
            margin-top: 15px;
            font-weight: 300;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.03); opacity: 0.9; }
        }

        /* Lock Screen */
        #lockScreen {
            position: fixed;
            inset: 0;
            background: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920') center/cover;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .lock-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(15px);
        }

        .lock-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .lock-time {
            color: white;
            font-size: 86px;
            font-weight: 300;
            text-shadow: 0 2px 30px rgba(0,0,0,0.5);
            letter-spacing: 2px;
        }

        .lock-date {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
            margin-bottom: 60px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            font-weight: 300;
        }

        .lock-avatar {
            width: 96px;
            height: 96px;
            background: linear-gradient(135deg, var(--plasma-surface) 0%, var(--plasma-surface-light) 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            border: 3px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .lock-username {
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .lock-input {
            width: 260px;
            padding: 12px 18px;
            background: rgba(255,255,255,0.12);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }

        .lock-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .lock-input:focus {
            border-color: var(--plasma-accent);
            background: rgba(255,255,255,0.18);
            box-shadow: 0 0 0 3px rgba(61, 174, 233, 0.2);
        }

        .lock-hint {
            color: rgba(255,255,255,0.5);
            font-size: 11px;
            margin-top: 12px;
        }

        /* Desktop */
        #desktop {
            position: fixed;
            inset: 0;
            display: none;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 50%, #1a1a2e 100%);
        }

        #desktopWallpaper {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 50%, #1a1a2e 100%);
            z-index: 0;
        }

        #desktopIcons {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            grid-template-columns: repeat(2, 85px);
            gap: 5px;
            padding: 5px;
            z-index: 1;
        }

        .desktop-icon {
            width: 80px;
            padding: 10px 8px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background 0.15s;
        }

        .desktop-icon:hover {
            background: rgba(255,255,255,0.1);
        }

        .desktop-icon.selected {
            background: rgba(61,174,233,0.4);
        }

        .desktop-icon-img {
            width: 48px;
            height: 48px;
            margin: 0 auto 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .desktop-icon-img i {
            font-size: 42px;
            color: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .desktop-icon-name {
            color: white;
            font-size: 11px;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
            word-wrap: break-word;
            line-height: 1.3;
        }

        /* Panel (Taskbar) */
        #panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 46px;
            background: rgba(26, 29, 33, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            padding: 0 6px;
            z-index: 1000;
            border-top: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 -2px 20px rgba(0,0,0,0.3);
        }

        #appLauncher {
            width: 46px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.15s;
            margin-right: 6px;
        }

        #appLauncher:hover {
            background: rgba(255,255,255,0.1);
        }

        #appLauncher .logo-3d-r {
            font-size: 26px;
        }

        #taskManager {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 3px;
            height: 100%;
            padding: 4px 0;
            overflow-x: auto;
        }

        .task-item {
            height: 38px;
            padding: 0 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.06);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid transparent;
            max-width: 200px;
            flex-shrink: 0;
        }

        .task-item:hover {
            background: rgba(255,255,255,0.12);
        }

        .task-item.active {
            background: rgba(61, 174, 233, 0.25);
            border-color: var(--plasma-accent);
        }

        .task-item-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .task-item-title {
            color: var(--plasma-text);
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #systemTray {
            display: flex;
            align-items: center;
            gap: 2px;
            padding: 0 8px;
            height: 100%;
        }

        .tray-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.15s;
            color: var(--plasma-text);
        }

        .tray-icon:hover {
            background: rgba(255,255,255,0.1);
        }

        #clockWidget {
            padding: 0 14px;
            height: 38px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.15s;
        }

        #clockWidget:hover {
            background: rgba(255,255,255,0.1);
        }

        #clockTime {
            color: var(--plasma-text);
            font-size: 13px;
            font-weight: 500;
        }

        #clockDate {
            color: var(--plasma-text-secondary);
            font-size: 10px;
        }

        /* Application Menu */
        #appMenu {
            position: fixed;
            bottom: 52px;
            left: 6px;
            width: 720px;
            height: 520px;
            background: rgba(35, 38, 41, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 12px;
            display: none;
            z-index: 2000;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.08);
            overflow: hidden;
        }

        .app-menu-header {
            padding: 14px;
            border-bottom: 1px solid var(--plasma-border);
        }

        .app-menu-search {
            width: 100%;
            padding: 11px 16px;
            background: var(--plasma-bg);
            border: 1px solid var(--plasma-border);
            border-radius: 8px;
            color: var(--plasma-text);
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
        }

        .app-menu-search:focus {
            border-color: var(--plasma-accent);
            box-shadow: 0 0 0 3px rgba(61, 174, 233, 0.15);
        }

        .app-menu-content {
            display: flex;
            height: calc(100% - 110px);
        }

        .app-menu-sidebar {
            width: 200px;
            background: rgba(27, 30, 32, 0.5);
            border-right: 1px solid var(--plasma-border);
            padding: 8px;
            display: flex;
            flex-direction: column;
        }

        .app-menu-category {
            padding: 10px 14px;
            color: var(--plasma-text);
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.15s;
        }

        .app-menu-category:hover,
        .app-menu-category.active {
            background: rgba(61, 174, 233, 0.2);
        }

        .app-menu-category.active {
            color: var(--plasma-accent);
        }

        .app-menu-category i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .app-menu-apps {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            align-content: start;
        }

        .app-menu-item {
            padding: 14px 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background 0.15s;
        }

        .app-menu-item:hover {
            background: rgba(255,255,255,0.08);
        }

        .app-menu-item-icon {
            font-size: 36px;
            margin-bottom: 8px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-menu-item-icon i {
            font-size: 32px;
            color: var(--plasma-text);
        }

        .app-menu-item-name {
            color: var(--plasma-text);
            font-size: 11px;
            line-height: 1.3;
        }

        .app-menu-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 14px;
            background: rgba(27, 30, 32, 0.8);
            border-top: 1px solid var(--plasma-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-menu-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .app-menu-user:hover {
            background: rgba(255,255,255,0.08);
        }

        .app-menu-user-avatar {
            width: 36px;
            height: 36px;
            background: var(--plasma-surface-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .app-menu-user-name {
            color: var(--plasma-text);
            font-size: 13px;
        }

        .app-menu-power {
            display: flex;
            gap: 6px;
        }

        .app-menu-power-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.15s;
            color: var(--plasma-text);
        }

        .app-menu-power-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .app-menu-power-btn.danger:hover {
            background: rgba(218, 68, 83, 0.3);
            color: var(--plasma-danger);
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--plasma-surface);
            border-radius: 10px;
            box-shadow: 0 15px 60px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.08);
            display: flex;
            flex-direction: column;
            min-width: 300px;
            min-height: 200px;
            overflow: hidden;
        }

        .window-header {
            height: 38px;
            background: var(--window-header);
            display: flex;
            align-items: center;
            padding: 0 10px;
            cursor: move;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0;
        }

        .window.inactive .window-header {
            background: var(--window-header-inactive);
        }

        .window-icon {
            font-size: 16px;
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .window-title {
            flex: 1;
            color: var(--plasma-text);
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .window.inactive .window-title {
            color: var(--plasma-text-secondary);
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 8px;
            transition: all 0.15s;
            border: none;
            color: transparent;
        }

        .window-btn:hover {
            color: rgba(0,0,0,0.7);
        }

        .window-btn-minimize { background: #f1c40f; }
        .window-btn-maximize { background: #2ecc71; }
        .window-btn-close { background: #e74c3c; }

        .window-content {
            flex: 1;
            overflow: auto;
            background: var(--plasma-bg);
        }

        .window-resize {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 18px;
            height: 18px;
            cursor: se-resize;
        }

        /* Context Menu */
        #contextMenu {
            position: fixed;
            background: rgba(35, 38, 41, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.08);
            display: none;
            z-index: 5000;
            min-width: 200px;
            padding: 6px;
        }

        .context-item {
            padding: 10px 14px;
            color: var(--plasma-text);
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.1s;
        }

        .context-item:hover {
            background: var(--plasma-accent);
        }

        .context-item i {
            width: 18px;
            text-align: center;
            font-size: 14px;
        }

        .context-separator {
            height: 1px;
            background: var(--plasma-border);
            margin: 6px 0;
        }

        /* Notifications */
        #notifications {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 6000;
            pointer-events: none;
        }

        .notification {
            background: rgba(35, 38, 41, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 14px 18px;
            min-width: 300px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 14px;
            pointer-events: auto;
        }

        .notification-icon { font-size: 22px; }
        .notification-text { color: var(--plasma-text); font-size: 13px; flex: 1; }
        .notification-close {
            color: var(--plasma-text-secondary);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: background 0.15s;
        }
        .notification-close:hover { background: rgba(255,255,255,0.1); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: var(--plasma-bg); }
        ::-webkit-scrollbar-thumb { background: var(--plasma-border); border-radius: 5px; border: 2px solid var(--plasma-bg); }
        ::-webkit-scrollbar-thumb:hover { background: var(--plasma-text-secondary); }

        /* KDE App Styles */
        .kde-toolbar {
            background: var(--plasma-surface);
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            border-bottom: 1px solid var(--plasma-border);
            flex-wrap: wrap;
        }

        .kde-btn {
            padding: 7px 14px;
            background: rgba(255,255,255,0.06);
            border: 1px solid var(--plasma-border);
            border-radius: 6px;
            color: var(--plasma-text);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .kde-btn:hover {
            background: var(--plasma-accent);
            border-color: var(--plasma-accent);
        }

        .kde-btn i { font-size: 12px; }

        .kde-input {
            padding: 9px 14px;
            background: var(--plasma-bg);
            border: 1px solid var(--plasma-border);
            border-radius: 6px;
            color: var(--plasma-text);
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
        }

        .kde-input:focus {
            border-color: var(--plasma-accent);
            box-shadow: 0 0 0 3px rgba(61, 174, 233, 0.15);
        }

        /* Dolphin File Manager */
        .dolphin-sidebar {
            width: 200px;
            background: var(--plasma-surface);
            border-right: 1px solid var(--plasma-border);
            padding: 10px;
            overflow-y: auto;
        }

        .dolphin-section-title {
            color: var(--plasma-text-secondary);
            font-size: 11px;
            font-weight: 600;
            padding: 10px 8px 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dolphin-place {
            padding: 9px 12px;
            color: var(--plasma-text);
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.15s;
        }

        .dolphin-place:hover { background: rgba(255,255,255,0.06); }
        .dolphin-place.active { background: var(--plasma-accent); }
        .dolphin-place i { font-size: 16px; width: 20px; text-align: center; }

        .dolphin-content {
            flex: 1;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            align-content: start;
            overflow-y: auto;
        }

        .dolphin-item {
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background 0.15s;
        }

        .dolphin-item:hover { background: rgba(255,255,255,0.06); }
        .dolphin-item.selected { background: rgba(61,174,233,0.3); }

        .dolphin-item-icon {
            font-size: 44px;
            margin-bottom: 6px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dolphin-item-icon i { font-size: 40px; }
        .dolphin-item-name { color: var(--plasma-text); font-size: 11px; word-break: break-word; line-height: 1.3; }

        /* Terminal Konsole */
        .konsole {
            background: #0c0c0c;
            color: #dcdcdc;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            padding: 12px;
            height: 100%;
            overflow-y: auto;
        }

        .konsole-line { margin-bottom: 3px; white-space: pre-wrap; word-break: break-all; line-height: 1.5; }
        .konsole-prompt { color: #26a269; font-weight: 600; }
        .konsole-path { color: #3daee9; }
        .konsole-input {
            background: transparent;
            border: none;
            color: #dcdcdc;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            width: calc(100% - 220px);
            caret-color: #3daee9;
        }

        /* Settings */
        .settings-sidebar {
            width: 240px;
            background: var(--plasma-surface);
            border-right: 1px solid var(--plasma-border);
            overflow-y: auto;
        }

        .settings-section { padding: 8px; border-bottom: 1px solid var(--plasma-border); }
        .settings-section-title {
            color: var(--plasma-text-secondary);
            font-size: 11px;
            font-weight: 600;
            padding: 10px 12px 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .settings-item {
            padding: 11px 14px;
            color: var(--plasma-text);
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.15s;
        }

        .settings-item:hover { background: rgba(255,255,255,0.06); }
        .settings-item.active { background: var(--plasma-accent); }
        .settings-item i { font-size: 16px; width: 20px; text-align: center; }

        .settings-content { flex: 1; padding: 24px; overflow-y: auto; }
        .settings-title { color: var(--plasma-text); font-size: 22px; font-weight: 500; margin-bottom: 24px; }

        /* About System */
        .about-logo { text-align: center; margin-bottom: 24px; }
        .about-logo .logo-3d-r { font-size: 80px; margin-bottom: 16px; display: inline-block; }
        .about-title { font-size: 28px; color: var(--plasma-text); margin-bottom: 6px; }
        .about-subtitle { color: var(--plasma-accent); font-size: 14px; }

        .about-info {
            background: var(--plasma-surface);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .about-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--plasma-border);
        }

        .about-row:last-child { border-bottom: none; }
        .about-label { color: var(--plasma-text-secondary); }
        .about-value { color: var(--plasma-text); text-align: right; }

        /* Game styles */
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: var(--plasma-bg);
            padding: 20px;
        }

        .game-canvas {
            border: 2px solid var(--plasma-border);
            border-radius: 8px;
            background: #1a1a2e;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 15px;
            color: var(--plasma-text);
        }

        .game-score { font-size: 18px; font-weight: 600; }
        .game-controls { margin-top: 15px; display: flex; gap: 10px; }

        /* Wallpaper selector */
        .wallpaper-item:hover {
            border-color: var(--plasma-accent) !important;
            opacity: 0.9;
            transform: scale(1.02);
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div id="bootScreen">
        <div class="boot-logo"><span class="logo-3d-r">R</span></div>
        <div class="boot-text">Runget 2.0</div>
        <div class="boot-spinner"><div class="boot-spinner-bar" id="bootProgress"></div></div>
        <div class="boot-status" id="bootStatus">Инициализация системы...</div>
    </div>

    <!-- Lock Screen -->
    <div id="lockScreen">
        <div class="lock-overlay"></div>
        <div class="lock-content">
            <div class="lock-time" id="lockTime"></div>
            <div class="lock-date" id="lockDate"></div>
            <div class="lock-avatar"><i class="fas fa-user"></i></div>
            <div class="lock-username">Пользователь</div>
            <input type="password" class="lock-input" id="lockPassword" placeholder="Введите пароль...">
            <div class="lock-hint">Нажмите Enter для входа</div>
        </div>
    </div>

    <!-- Desktop -->
    <div id="desktop">
        <div id="desktopWallpaper"></div>
        <div id="desktopIcons"></div>
        <div id="windowsContainer"></div>

        <div id="panel">
            <div id="appLauncher"><span class="logo-3d-r">R</span></div>
            <div id="taskManager"></div>
            <div id="systemTray">
                <div class="tray-icon" title="Сеть"><i class="fas fa-wifi"></i></div>
                <div class="tray-icon" title="Звук"><i class="fas fa-volume-up"></i></div>
                <div class="tray-icon" title="Батарея"><i class="fas fa-battery-three-quarters"></i></div>
                <div class="tray-icon" onclick="openApp('spectacle')" title="Скриншот"><i class="fas fa-camera"></i></div>
            </div>
            <div id="clockWidget">
                <div id="clockTime"></div>
                <div id="clockDate"></div>
            </div>
        </div>

        <div id="appMenu">
            <div class="app-menu-header">
                <input type="text" class="app-menu-search" id="appSearch" placeholder="Поиск приложений...">
            </div>
            <div class="app-menu-content">
                <div class="app-menu-sidebar">
                    <div class="app-menu-category active" data-category="all"><i class="fas fa-th-large"></i> Все приложения</div>
                    <div class="app-menu-category" data-category="system"><i class="fas fa-cog"></i> Система</div>
                    <div class="app-menu-category" data-category="utilities"><i class="fas fa-tools"></i> Утилиты</div>
                    <div class="app-menu-category" data-category="office"><i class="fas fa-file-alt"></i> Офис</div>
                    <div class="app-menu-category" data-category="multimedia"><i class="fas fa-photo-video"></i> Мультимедиа</div>
                    <div class="app-menu-category" data-category="internet"><i class="fas fa-globe"></i> Интернет</div>
                    <div class="app-menu-category" data-category="games"><i class="fas fa-gamepad"></i> Игры</div>
                    <div class="app-menu-category" data-category="benchmark"><i class="fas fa-tachometer-alt"></i> Тесты</div>
                </div>
                <div class="app-menu-apps" id="appMenuApps"></div>
            </div>
            <div class="app-menu-footer">
                <div class="app-menu-user">
                    <div class="app-menu-user-avatar"><i class="fas fa-user"></i></div>
                    <span class="app-menu-user-name">Пользователь</span>
                </div>
                <div class="app-menu-power">
                    <div class="app-menu-power-btn" onclick="lockScreen()" title="Заблокировать"><i class="fas fa-lock"></i></div>
                    <div class="app-menu-power-btn" onclick="location.reload()" title="Перезагрузка"><i class="fas fa-redo"></i></div>
                    <div class="app-menu-power-btn danger" onclick="document.body.innerHTML='<div style=\'display:flex;align-items:center;justify-content:center;height:100vh;background:#000;color:#fff;font-size:24px\'>Система выключена</div>'" title="Выключение"><i class="fas fa-power-off"></i></div>
                </div>
            </div>
        </div>

        <div id="contextMenu"></div>
        <div id="notifications"></div>
    </div>

    <script>
        // ==================== RUNGET 2.0 SYSTEM ====================
        const Runget = {
            version: '2.0',
            codename: 'Anythink Anywhere',
            kernel: '6.1.0-runget',
            desktop: 'KDE Plasma 5.27.10',
            based: 'Debian 13 / Ubuntu',
            
            windows: new Map(),
            windowOrder: [],
            activeWindow: null,
            windowId: 0,
            dragState: null,
            resizeState: null,
            
            fileSystem: {
                '/': { type: 'folder', children: {
                    'home': { type: 'folder', children: {
                        'user': { type: 'folder', children: {
                            'Документы': { type: 'folder', children: {
                                'readme.txt': { type: 'file', content: 'Добро пожаловать в Runget 2.0!\n\nЭто быстрая, простая и красивая операционная система.\nОснована на Debian и Ubuntu.\n\nРазработчики:\n- Kolyadual\n- Kirilldual\n- Seregaosm\n- Neeby' },
                                'notes.txt': { type: 'file', content: 'Мои заметки\n\n- Изучить Runget 2.0\n- Настроить систему' }
                            }},
                            'Загрузки': { type: 'folder', children: {} },
                            'Изображения': { type: 'folder', children: {
                                'screenshot.png': { type: 'file', content: '[Изображение]' }
                            }},
                            'Музыка': { type: 'folder', children: {} },
                            'Видео': { type: 'folder', children: {} },
                            'Рабочий стол': { type: 'folder', children: {} }
                        }}
                    }},
                    'etc': { type: 'folder', children: {
                        'os-release': { type: 'file', content: 'PRETTY_NAME="Runget 2.0 (Anythink Anywhere)"\nNAME="Runget"\nVERSION_ID="2.0"\nVERSION="2.0 (Anythink Anywhere)"\nID=runget\nID_LIKE="debian ubuntu"\nHOME_URL="https://t.me/runget_rt"' }
                    }},
                    'usr': { type: 'folder', children: {} },
                    'var': { type: 'folder', children: {} }
                }}
            },
            
            settings: { wallpaper: 0 }
        };

        const wallpapers = [
            { name: 'Runget Default', gradient: 'linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 50%, #1a1a2e 100%)' },
            { name: 'Ocean Depths', gradient: 'linear-gradient(135deg, #0c3547 0%, #0d47a1 50%, #1565c0 100%)' },
            { name: 'Aurora Borealis', gradient: 'linear-gradient(135deg, #1a237e 0%, #00695c 50%, #004d40 100%)' },
            { name: 'Sunset Glow', gradient: 'linear-gradient(135deg, #4a148c 0%, #880e4f 50%, #e65100 100%)' },
            { name: 'Forest Night', gradient: 'linear-gradient(135deg, #1b5e20 0%, #2e7d32 30%, #0d1b0d 100%)' },
            { name: 'Crimson Twilight', gradient: 'linear-gradient(135deg, #4a0000 0%, #8e0000 50%, #1a0a0a 100%)' },
            { name: 'Purple Nebula', gradient: 'linear-gradient(135deg, #311b92 0%, #7b1fa2 50%, #4a148c 100%)' },
            { name: 'Arctic Blue', gradient: 'linear-gradient(135deg, #006064 0%, #00838f 50%, #0097a7 100%)' },
            { name: 'Dark Matter', gradient: 'linear-gradient(135deg, #0d0d0d 0%, #1a1a2e 50%, #0f0f23 100%)' },
            { name: 'Golden Hour', gradient: 'linear-gradient(135deg, #bf360c 0%, #f57c00 50%, #ff8f00 100%)' },
            { name: 'Deep Space', gradient: 'linear-gradient(135deg, #000428 0%, #004e92 100%)' },
            { name: 'Emerald Dream', gradient: 'linear-gradient(135deg, #134e5e 0%, #71b280 100%)' },
            { name: 'Midnight City', gradient: 'linear-gradient(135deg, #232526 0%, #414345 100%)' },
            { name: 'Royal Purple', gradient: 'linear-gradient(135deg, #141e30 0%, #243b55 50%, #4b134f 100%)' },
            { name: 'Plasma Blue', gradient: 'linear-gradient(135deg, #3daee9 0%, #2980b9 50%, #1a5276 100%)' },
            { name: 'Volcanic', gradient: 'linear-gradient(135deg, #200122 0%, #6f0000 100%)' }
        ];

        const apps = [
            { id: 'dolphin', name: 'Dolphin', icon: 'fa-folder', category: 'system', desktop: true },
            { id: 'konsole', name: 'Konsole', icon: 'fa-terminal', category: 'system', desktop: true },
            { id: 'kate', name: 'Kate', icon: 'fa-file-code', category: 'utilities', desktop: true },
            { id: 'settings', name: 'Параметры', icon: 'fa-cog', category: 'system', desktop: true },
            { id: 'info', name: 'О системе', icon: 'fa-info-circle', category: 'system', desktop: true },
            { id: 'dgc', name: 'DGC', icon: 'fa-gamepad', category: 'games', desktop: true },
            { id: 'speedtest', name: 'Speedtest', icon: 'fa-tachometer-alt', category: 'benchmark', desktop: true },
            { id: 'speedtest-light', name: 'Speedtest Light', icon: 'fa-bolt', category: 'benchmark', desktop: true },
            { id: '3d-benchmark', name: '3D Benchmark', icon: 'fa-cube', category: 'benchmark', desktop: true },
            { id: 'calculator', name: 'Калькулятор', icon: 'fa-calculator', category: 'utilities', desktop: false },
            { id: 'spectacle', name: 'Spectacle', icon: 'fa-camera', category: 'utilities', desktop: false },
            { id: 'gwenview', name: 'Gwenview', icon: 'fa-image', category: 'multimedia', desktop: false },
            { id: 'elisa', name: 'Elisa', icon: 'fa-music', category: 'multimedia', desktop: false },
            { id: 'okular', name: 'Okular', icon: 'fa-file-pdf', category: 'office', desktop: false },
            { id: 'calendar', name: 'Календарь', icon: 'fa-calendar-alt', category: 'utilities', desktop: false },
            { id: 'weather', name: 'Погода', icon: 'fa-cloud-sun', category: 'utilities', desktop: false },
            { id: 'monitor', name: 'Системный монитор', icon: 'fa-chart-area', category: 'system', desktop: false },
            { id: 'firefox', name: 'Firefox', icon: 'fa-firefox-browser', iconType: 'fab', category: 'internet', desktop: false },
            { id: 'krita', name: 'Krita', icon: 'fa-paint-brush', category: 'multimedia', desktop: false },
            { id: 'libreoffice', name: 'LibreOffice', icon: 'fa-file-word', category: 'office', desktop: false },
            { id: 'snake', name: 'Змейка', icon: 'fa-gamepad', category: 'games', desktop: false },
            { id: 'tetris', name: 'Тетрис', icon: 'fa-th', category: 'games', desktop: false },
            { id: 'pong', name: 'Пинг-понг', icon: 'fa-table-tennis', category: 'games', desktop: false },
            { id: 'game2048', name: '2048', icon: 'fa-th-large', category: 'games', desktop: false },
            { id: 'minesweeper', name: 'Сапёр', icon: 'fa-bomb', category: 'games', desktop: false },
            { id: 'tictactoe', name: 'Крестики-нолики', icon: 'fa-times', category: 'games', desktop: false },
            { id: 'tasks', name: 'Задачи', icon: 'fa-tasks', category: 'utilities', desktop: false },
            { id: 'notes', name: 'Заметки', icon: 'fa-sticky-note', category: 'utilities', desktop: false },
            { id: 'clock', name: 'Часы', icon: 'fa-clock', category: 'utilities', desktop: false }
        ];

        // ==================== BOOT ====================
        async function boot() {
            const progress = document.getElementById('bootProgress');
            const status = document.getElementById('bootStatus');
            const messages = [
                'Инициализация ядра Linux 6.1.0-runget...',
                'Загрузка модулей Runget...',
                'Монтирование файловых систем...',
                'Запуск systemd...',
                'Инициализация KDE Plasma...',
                'Загрузка рабочего стола...'
            ];
            
            for (let i = 0; i <= 100; i++) {
                progress.style.width = i + '%';
                if (i % 18 === 0) status.textContent = messages[Math.floor(i / 18)] || messages[messages.length - 1];
                await new Promise(r => setTimeout(r, 25));
            }
            
            document.getElementById('bootScreen').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            updateLockTime();
        }

        function updateLockTime() {
            const now = new Date();
            document.getElementById('lockTime').textContent = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lockDate').textContent = now.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateLockTime, 1000);

        document.getElementById('lockPassword').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('desktop').style.display = 'block';
                initDesktop();
                showNotification('Добро пожаловать в Runget 2.0!', 'success');
            }
        });

        function lockScreen() {
            document.getElementById('appMenu').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            document.getElementById('lockPassword').value = '';
            document.getElementById('lockPassword').focus();
        }

        // ==================== DESKTOP ====================
        function initDesktop() {
            renderDesktopIcons();
            renderAppMenu();
            updateClock();
            setInterval(updateClock, 1000);
            
            // Применяем обои с небольшой задержкой для уверенности
            setTimeout(() => {
                applyWallpaper();
            }, 100);
            
            document.getElementById('appLauncher').onclick = toggleAppMenu;
            document.getElementById('clockWidget').onclick = () => openApp('calendar');
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#appMenu') && !e.target.closest('#appLauncher')) {
                    document.getElementById('appMenu').style.display = 'none';
                }
                document.getElementById('contextMenu').style.display = 'none';
            });
            
            document.getElementById('desktop').addEventListener('contextmenu', (e) => {
                if (!e.target.closest('.window')) {
                    e.preventDefault();
                    showContextMenu(e.clientX, e.clientY);
                }
            });
            
            // Дополнительно загружаем сохранённые настройки из localStorage
            const savedWallpaper = localStorage.getItem('runget-wallpaper');
            if (savedWallpaper !== null) {
                Runget.settings.wallpaper = parseInt(savedWallpaper);
                applyWallpaper();
            }
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clockTime').textContent = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clockDate').textContent = now.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short' });
        }

        function renderDesktopIcons() {
            const container = document.getElementById('desktopIcons');
            apps.filter(a => a.desktop).forEach(app => {
                const icon = document.createElement('div');
                icon.className = 'desktop-icon';
                const iconClass = app.iconType === 'fab' ? 'fab' : 'fas';
                icon.innerHTML = `
                    <div class="desktop-icon-img"><i class="${iconClass} ${app.icon}"></i></div>
                    <div class="desktop-icon-name">${app.name}</div>
                `;
                icon.ondblclick = () => openApp(app.id);
                icon.onclick = () => {
                    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                    icon.classList.add('selected');
                };
                container.appendChild(icon);
            });
        }

        function renderAppMenu() {
            const container = document.getElementById('appMenuApps');
            apps.forEach(app => {
                const item = document.createElement('div');
                item.className = 'app-menu-item';
                item.dataset.category = app.category;
                const iconClass = app.iconType === 'fab' ? 'fab' : 'fas';
                item.innerHTML = `
                    <div class="app-menu-item-icon"><i class="${iconClass} ${app.icon}"></i></div>
                    <div class="app-menu-item-name">${app.name}</div>
                `;
                item.onclick = () => { openApp(app.id); toggleAppMenu(); };
                container.appendChild(item);
            });
            
            document.querySelectorAll('.app-menu-category').forEach(cat => {
                cat.onclick = () => {
                    document.querySelectorAll('.app-menu-category').forEach(c => c.classList.remove('active'));
                    cat.classList.add('active');
                    const category = cat.dataset.category;
                    document.querySelectorAll('.app-menu-item').forEach(item => {
                        item.style.display = (category === 'all' || item.dataset.category === category) ? 'block' : 'none';
                    });
                };
            });
            
            document.getElementById('appSearch').oninput = (e) => {
                const query = e.target.value.toLowerCase();
                document.querySelectorAll('.app-menu-item').forEach(item => {
                    item.style.display = item.querySelector('.app-menu-item-name').textContent.toLowerCase().includes(query) ? 'block' : 'none';
                });
            };
        }

        function toggleAppMenu() {
            const menu = document.getElementById('appMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            if (menu.style.display === 'block') document.getElementById('appSearch').focus();
        }

        function applyWallpaper() {
            const wallpaper = wallpapers[Runget.settings.wallpaper];
            const desktopWallpaper = document.getElementById('desktopWallpaper');
            if (desktopWallpaper && wallpaper) {
                desktopWallpaper.style.background = wallpaper.gradient;
                localStorage.setItem('runget-wallpaper', Runget.settings.wallpaper);
            }
        }

        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            menu.innerHTML = `
                <div class="context-item" onclick="openApp('dolphin')"><i class="fas fa-folder"></i> Открыть Dolphin</div>
                <div class="context-item" onclick="openApp('konsole')"><i class="fas fa-terminal"></i> Открыть Konsole</div>
                <div class="context-separator"></div>
                <div class="context-item" onclick="openApp('spectacle')"><i class="fas fa-camera"></i> Сделать скриншот</div>
                <div class="context-separator"></div>
                <div class="context-item" onclick="openApp('settings')"><i class="fas fa-cog"></i> Параметры системы</div>
                <div class="context-item" onclick="openApp('info')"><i class="fas fa-info-circle"></i> О системе</div>
            `;
            menu.style.left = Math.min(x, window.innerWidth - 220) + 'px';
            menu.style.top = Math.min(y, window.innerHeight - 250) + 'px';
            menu.style.display = 'block';
        }

        function showNotification(text, type = 'info') {
            const icons = { info: 'fa-info-circle', success: 'fa-check-circle', warning: 'fa-exclamation-triangle', error: 'fa-times-circle' };
            const colors = { info: '#3daee9', success: '#27ae60', warning: '#f39c12', error: '#da4453' };
            const container = document.getElementById('notifications');
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.innerHTML = `
                <span class="notification-icon" style="color:${colors[type]}"><i class="fas ${icons[type]}"></i></span>
                <span class="notification-text">${text}</span>
                <span class="notification-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></span>
            `;
            container.appendChild(notif);
            setTimeout(() => notif.remove(), 5000);
        }

        // ==================== WINDOW MANAGEMENT ====================
        function createWindow(options) {
            const id = Runget.windowId++;
            const win = {
                id,
                title: options.title || 'Окно',
                icon: options.icon || 'fa-window-maximize',
                iconType: options.iconType || 'fas',
                width: options.width || 750,
                height: options.height || 500,
                x: options.x ?? 80 + (Runget.windows.size * 25) % 200,
                y: options.y ?? 50 + (Runget.windows.size * 25) % 150,
                minimized: false,
                maximized: false,
                content: options.content || '',
                appId: options.appId
            };
            
            Runget.windows.set(id, win);
            Runget.windowOrder.push(id);
            renderWindow(win);
            focusWindow(id);
            updateTaskbar();
            return id;
        }

        function renderWindow(win) {
            const el = document.createElement('div');
            el.id = `window-${win.id}`;
            el.className = 'window';
            el.style.cssText = `left:${win.x}px;top:${win.y}px;width:${win.width}px;height:${win.height}px;z-index:${100 + Runget.windowOrder.indexOf(win.id)}`;
            const iconClass = win.iconType === 'fab' ? 'fab' : 'fas';
            el.innerHTML = `
                <div class="window-header" data-window="${win.id}">
                    <span class="window-icon"><i class="${iconClass} ${win.icon}"></i></span>
                    <span class="window-title">${win.title}</span>
                    <div class="window-controls">
                        <button class="window-btn window-btn-minimize" onclick="minimizeWindow(${win.id})"><i class="fas fa-minus"></i></button>
                        <button class="window-btn window-btn-maximize" onclick="maximizeWindow(${win.id})"><i class="fas fa-square"></i></button>
                        <button class="window-btn window-btn-close" onclick="closeWindow(${win.id})"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div class="window-content">${win.content}</div>
                <div class="window-resize" data-window="${win.id}"></div>
            `;
            document.getElementById('windowsContainer').appendChild(el);
            
            const header = el.querySelector('.window-header');
            header.onmousedown = (e) => {
                if (e.target.closest('.window-controls')) return;
                focusWindow(win.id);
                const w = Runget.windows.get(win.id);
                if (w.maximized) return;
                Runget.dragState = { id: win.id, startX: e.clientX - w.x, startY: e.clientY - w.y };
            };
            
            header.ondblclick = (e) => { if (!e.target.closest('.window-controls')) maximizeWindow(win.id); };
            
            el.querySelector('.window-resize').onmousedown = (e) => {
                e.stopPropagation();
                const w = Runget.windows.get(win.id);
                Runget.resizeState = { id: win.id, startX: e.clientX, startY: e.clientY, startW: w.width, startH: w.height };
            };
            
            el.onmousedown = () => focusWindow(win.id);
        }

        document.addEventListener('mousemove', (e) => {
            if (Runget.dragState) {
                const win = Runget.windows.get(Runget.dragState.id);
                win.x = e.clientX - Runget.dragState.startX;
                win.y = Math.max(0, e.clientY - Runget.dragState.startY);
                const el = document.getElementById(`window-${win.id}`);
                el.style.left = win.x + 'px';
                el.style.top = win.y + 'px';
            }
            if (Runget.resizeState) {
                const win = Runget.windows.get(Runget.resizeState.id);
                win.width = Math.max(300, Runget.resizeState.startW + e.clientX - Runget.resizeState.startX);
                win.height = Math.max(200, Runget.resizeState.startH + e.clientY - Runget.resizeState.startY);
                const el = document.getElementById(`window-${win.id}`);
                el.style.width = win.width + 'px';
                el.style.height = win.height + 'px';
            }
        });

        document.addEventListener('mouseup', () => { Runget.dragState = null; Runget.resizeState = null; });

        function focusWindow(id) {
            Runget.activeWindow = id;
            Runget.windowOrder = Runget.windowOrder.filter(i => i !== id);
            Runget.windowOrder.push(id);
            Runget.windows.forEach((w, wid) => {
                const el = document.getElementById(`window-${wid}`);
                if (el) {
                    el.style.zIndex = 100 + Runget.windowOrder.indexOf(wid);
                    el.classList.toggle('inactive', wid !== id);
                }
            });
            updateTaskbar();
        }

        function minimizeWindow(id) {
            const win = Runget.windows.get(id);
            win.minimized = !win.minimized;
            document.getElementById(`window-${id}`).style.display = win.minimized ? 'none' : 'flex';
            updateTaskbar();
        }

        function maximizeWindow(id) {
            const win = Runget.windows.get(id);
            const el = document.getElementById(`window-${id}`);
            win.maximized = !win.maximized;
            if (win.maximized) {
                win.prevState = { x: win.x, y: win.y, width: win.width, height: win.height };
                el.style.cssText = `left:0;top:0;width:100%;height:calc(100% - 46px);z-index:${el.style.zIndex};border-radius:0`;
            } else {
                Object.assign(win, win.prevState);
                el.style.cssText = `left:${win.x}px;top:${win.y}px;width:${win.width}px;height:${win.height}px;z-index:${el.style.zIndex}`;
            }
        }

        function closeWindow(id) {
            document.getElementById(`window-${id}`)?.remove();
            Runget.windows.delete(id);
            Runget.windowOrder = Runget.windowOrder.filter(i => i !== id);
            updateTaskbar();
        }

        function updateTaskbar() {
            const container = document.getElementById('taskManager');
            container.innerHTML = '';
            Runget.windows.forEach((win, id) => {
                const item = document.createElement('div');
                item.className = `task-item ${Runget.activeWindow === id && !win.minimized ? 'active' : ''}`;
                const iconClass = win.iconType === 'fab' ? 'fab' : 'fas';
                item.innerHTML = `<span class="task-item-icon"><i class="${iconClass} ${win.icon}"></i></span><span class="task-item-title">${win.title}</span>`;
                item.onclick = () => {
                    if (win.minimized) minimizeWindow(id);
                    else if (Runget.activeWindow === id) minimizeWindow(id);
                    else focusWindow(id);
                };
                container.appendChild(item);
            });
        }

        // ==================== APPLICATIONS ====================
        function openApp(appId, params = {}) {
            const handlers = {
                dolphin: () => openDolphin(params.path || '/home/user'),
                konsole: openKonsole,
                kate: () => openKate(params.file),
                settings: openSettings,
                info: openSystemInfo,
                dgc: () => openWebApp('DGC - Dual Gaming Centre', 'fa-gamepad', 'https://kolyadual.github.io/dualgamingcentre/', 1100, 700),
                speedtest: () => openWebApp('Speedtest', 'fa-tachometer-alt', 'https://kirilldual0987.github.io/dual-speed-tester/', 900, 650),
                'speedtest-light': () => openWebApp('Speedtest Light', 'fa-bolt', 'https://kirilldual0987.github.io/dual-speed-tester-light/', 900, 650),
                '3d-benchmark': () => openWebApp('3D Benchmark', 'fa-cube', 'https://kirilldual0987.github.io/dual-3d_benchmark-online/', 1000, 700),
                calculator: openCalculator,
                spectacle: openSpectacle,
                gwenview: openGwenview,
                elisa: openElisa,
                okular: openOkular,
                calendar: openCalendar,
                weather: openWeather,
                monitor: openSystemMonitor,
                firefox: () => openWebApp('Firefox', 'fa-firefox-browser', 'https://www.google.com/webhp?igu=1', 1000, 650, 'fab'),
                krita: openKrita,
                libreoffice: openLibreOffice,
                snake: openSnake,
                tetris: openTetris,
                pong: openPong,
                game2048: open2048,
                minesweeper: openMinesweeper,
                tictactoe: openTicTacToe,
                tasks: openTasks,
                notes: openNotes,
                clock: openClock
            };
            if (handlers[appId]) handlers[appId]();
        }

        function openWebApp(title, icon, url, width = 900, height = 600, iconType = 'fas') {
            createWindow({
                title, icon, iconType, width, height,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="this.closest('.window-content').querySelector('iframe').src=this.closest('.window-content').querySelector('iframe').src"><i class="fas fa-redo"></i> Обновить</button>
                        <span style="flex:1"></span>
                        <button class="kde-btn" onclick="window.open('${url}','_blank')"><i class="fas fa-external-link-alt"></i> В браузере</button>
                    </div>
                    <iframe style="width:100%;height:calc(100% - 46px);border:none" src="${url}"></iframe>
                `, appId: title.toLowerCase()
            });
        }

        // Spectacle - Screenshot tool
        function openSpectacle() {
            createWindow({
                title: 'Spectacle - Скриншот',
                icon: 'fa-camera',
                width: 500,
                height: 400,
                content: `
                    <div style="padding:30px;text-align:center;height:100%;display:flex;flex-direction:column;justify-content:center;background:var(--plasma-bg)">
                        <i class="fas fa-camera" style="font-size:64px;color:var(--plasma-accent);margin-bottom:20px"></i>
                        <h2 style="color:var(--plasma-text);margin-bottom:10px">Spectacle</h2>
                        <p style="color:var(--plasma-text-secondary);margin-bottom:30px">Инструмент для создания скриншотов</p>
                        <div style="display:flex;flex-direction:column;gap:12px;max-width:300px;margin:0 auto">
                            <button class="kde-btn" style="justify-content:center;padding:15px" onclick="takeScreenshot('full')">
                                <i class="fas fa-desktop"></i> Весь экран
                            </button>
                            <button class="kde-btn" style="justify-content:center;padding:15px" onclick="takeScreenshot('desktop')">
                                <i class="fas fa-image"></i> Только рабочий стол
                            </button>
                        </div>
                    </div>
                `, appId: 'spectacle'
            });
        }

        async function takeScreenshot(mode) {
            showNotification('Создание скриншота...', 'info');
            try {
                const element = mode === 'full' ? document.body : document.getElementById('desktop');
                const canvas = await html2canvas(element, { useCORS: true, allowTaint: true, scale: 1 });
                const link = document.createElement('a');
                link.download = `screenshot-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                showNotification('Скриншот сохранён!', 'success');
            } catch (e) {
                showNotification('Ошибка создания скриншота', 'error');
            }
        }

        // Dolphin File Manager
        function openDolphin(path = '/home/user') {
            let currentPath = path;
            
            function getFolder(p) {
                const parts = p.split('/').filter(Boolean);
                let current = Runget.fileSystem['/'];
                for (const part of parts) {
                    if (current.children?.[part]) current = current.children[part];
                }
                return current;
            }
            
            function render() {
                const folder = getFolder(currentPath);
                const items = folder.children || {};
                return `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="this.closest('.window-content').__nav('..')"><i class="fas fa-arrow-left"></i></button>
                        <button class="kde-btn" onclick="this.closest('.window-content').__nav('/')"><i class="fas fa-home"></i></button>
                        <input class="kde-input" style="flex:1;margin:0 8px" value="${currentPath}" readonly>
                    </div>
                    <div style="display:flex;height:calc(100% - 46px)">
                        <div class="dolphin-sidebar">
                            <div class="dolphin-section-title">Места</div>
                            ${[
                                { icon: 'fa-home', name: 'Домой', path: '/home/user' },
                                { icon: 'fa-file-alt', name: 'Документы', path: '/home/user/Документы' },
                                { icon: 'fa-download', name: 'Загрузки', path: '/home/user/Загрузки' },
                                { icon: 'fa-image', name: 'Изображения', path: '/home/user/Изображения' },
                                { icon: 'fa-hdd', name: 'Корень', path: '/' }
                            ].map(p => `<div class="dolphin-place ${p.path === currentPath ? 'active' : ''}" onclick="this.closest('.window-content').__go('${p.path}')"><i class="fas ${p.icon}"></i> ${p.name}</div>`).join('')}
                        </div>
                        <div class="dolphin-content">
                            ${Object.entries(items).map(([name, item]) => `
                                <div class="dolphin-item" ondblclick="this.closest('.window-content').__open('${name}','${item.type}')">
                                    <div class="dolphin-item-icon"><i class="fas ${item.type === 'folder' ? 'fa-folder' : 'fa-file-alt'}" style="color:${item.type === 'folder' ? '#f8b84e' : '#bdc3c7'}"></i></div>
                                    <div class="dolphin-item-name">${name}</div>
                                </div>
                            `).join('') || '<div style="grid-column:1/-1;text-align:center;color:var(--plasma-text-secondary);padding:60px"><i class="fas fa-folder-open" style="font-size:48px;opacity:0.5;display:block;margin-bottom:16px"></i>Папка пуста</div>'}
                        </div>
                    </div>
                `;
            }
            
            const winId = createWindow({ title: 'Dolphin — ' + currentPath, icon: 'fa-folder', width: 900, height: 550, content: render(), appId: 'dolphin' });
            
            const contentEl = document.querySelector(`#window-${winId} .window-content`);
            function setupHandlers() {
                contentEl.__nav = (dir) => {
                    if (dir === '..') {
                        const parts = currentPath.split('/').filter(Boolean);
                        parts.pop();
                        currentPath = '/' + parts.join('/') || '/';
                    } else currentPath = dir;
                    contentEl.innerHTML = render();
                    document.querySelector(`#window-${winId} .window-title`).textContent = 'Dolphin — ' + currentPath;
                    setupHandlers();
                };
                contentEl.__go = (path) => { currentPath = path; contentEl.innerHTML = render(); document.querySelector(`#window-${winId} .window-title`).textContent = 'Dolphin — ' + currentPath; setupHandlers(); };
                contentEl.__open = (name, type) => {
                    if (type === 'folder') { currentPath = currentPath === '/' ? '/' + name : currentPath + '/' + name; contentEl.innerHTML = render(); document.querySelector(`#window-${winId} .window-title`).textContent = 'Dolphin — ' + currentPath; setupHandlers(); }
                    else { const folder = getFolder(currentPath); openApp('kate', { file: { name, content: folder.children[name].content } }); }
                };
            }
            setupHandlers();
        }

        // Konsole Terminal
        function openKonsole() {
            let history = ['Welcome to Runget 2.0 "Anythink Anywhere"', 'Type "help" for commands', ''];
            let cwd = '/home/user';
            
            function getFolder(p) {
                const parts = p.split('/').filter(Boolean);
                let current = Runget.fileSystem['/'];
                for (const part of parts) { if (current.children?.[part]) current = current.children[part]; }
                return current;
            }
            
            const winId = createWindow({
                title: 'Konsole', icon: 'fa-terminal', width: 750, height: 480,
                content: `<div class="konsole" id="konsole-${Runget.windowId}"><div id="konsoleOutput"></div><div style="display:flex"><span class="konsole-prompt">user@runget</span>:<span class="konsole-path">~</span>$ <input class="konsole-input" id="konsoleInput" autofocus></div></div>`,
                appId: 'konsole'
            });
            
            const output = document.getElementById('konsoleOutput');
            const input = document.getElementById('konsoleInput');
            
            function updateOutput() { output.innerHTML = history.map(l => `<div class="konsole-line">${l}</div>`).join(''); output.parentElement.scrollTop = output.parentElement.scrollHeight; }
            function updatePrompt() { input.previousElementSibling.textContent = cwd.replace('/home/user', '~') || '/'; }
            updateOutput();
            
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    const cmd = input.value.trim();
                    history.push(`<span class="konsole-prompt">user@runget</span>:<span class="konsole-path">${cwd.replace('/home/user', '~')}</span>$ ${cmd}`);
                    
                    if (cmd) {
                        const [command, ...args] = cmd.split(' ');
                        const commands = {
                            help: () => 'Commands: help, ls, cd, pwd, cat, mkdir, touch, rm, echo, clear, date, whoami, uname, neofetch, screenfetch',
                            ls: () => { const f = getFolder(cwd); return Object.entries(f.children || {}).map(([n, f]) => `<span style="color:${f.type === 'folder' ? '#3daee9' : '#eff0f1'}">${n}${f.type === 'folder' ? '/' : ''}</span>`).join('  '); },
                            cd: () => { if (!args[0] || args[0] === '~') { cwd = '/home/user'; updatePrompt(); return ''; } if (args[0] === '/') { cwd = '/'; updatePrompt(); return ''; } if (args[0] === '..') { const parts = cwd.split('/').filter(Boolean); parts.pop(); cwd = '/' + parts.join('/') || '/'; updatePrompt(); return ''; } const folder = getFolder(cwd); if (folder.children?.[args[0]]?.type === 'folder') { cwd = cwd === '/' ? '/' + args[0] : cwd + '/' + args[0]; updatePrompt(); return ''; } return `cd: ${args[0]}: No such directory`; },
                            pwd: () => cwd,
                            cat: () => { if (!args[0]) return 'cat: missing operand'; const f = getFolder(cwd); return f.children?.[args[0]]?.content?.replace(/\n/g, '<br>') || `cat: ${args[0]}: No such file`; },
                            mkdir: () => { if (!args[0]) return 'mkdir: missing operand'; getFolder(cwd).children[args[0]] = { type: 'folder', children: {} }; return ''; },
                            touch: () => { if (!args[0]) return 'touch: missing operand'; getFolder(cwd).children[args[0]] = { type: 'file', content: '' }; return ''; },
                            rm: () => { if (!args[0]) return 'rm: missing operand'; const f = getFolder(cwd); if (f.children?.[args[0]]) { delete f.children[args[0]]; return ''; } return `rm: ${args[0]}: No such file`; },
                            echo: () => args.join(' '),
                            clear: () => { history = []; return ''; },
                            date: () => new Date().toLocaleString('ru-RU'),
                            whoami: () => 'user',
                            hostname: () => 'runget-pc',
                            uname: () => args[0] === '-a' ? `Linux runget-pc ${Runget.kernel} x86_64 GNU/Linux` : 'Linux',
                            neofetch: () => `<span style="color:#3daee9">       RRRRRRRRRRRRR</span>         user@runget-pc
<span style="color:#3daee9">       RRRRRRRRRRRRRRRR</span>      ----------------
<span style="color:#3daee9">       RRRRR      RRRRR</span>      <span style="color:#3daee9">OS:</span> Runget 2.0 Anythink Anywhere
<span style="color:#3daee9">       RRRRR      RRRRR</span>      <span style="color:#3daee9">Host:</span> runget-pc
<span style="color:#3daee9">       RRRRR      RRRRR</span>      <span style="color:#3daee9">Kernel:</span> ${Runget.kernel}
<span style="color:#3daee9">       RRRRRRRRRRRRRRRR</span>      <span style="color:#3daee9">Uptime:</span> ${Math.floor(performance.now()/60000)} mins
<span style="color:#3daee9">       RRRRRRRRRRRRR</span>         <span style="color:#3daee9">Packages:</span> 2847 (dpkg)
<span style="color:#3daee9">       RRRRR   RRRRR</span>         <span style="color:#3daee9">Shell:</span> bash 5.2.15
<span style="color:#3daee9">       RRRRR    RRRRR</span>        <span style="color:#3daee9">Resolution:</span> ${window.innerWidth}x${window.innerHeight}
<span style="color:#3daee9">       RRRRR     RRRRR</span>       <span style="color:#3daee9">DE:</span> ${Runget.desktop}
<span style="color:#3daee9">       RRRRR      RRRRR</span>      <span style="color:#3daee9">WM:</span> KWin
<span style="color:#3daee9">       RRRRR       RRRRR</span>     <span style="color:#3daee9">Theme:</span> Breeze Dark
<span style="color:#3daee9">       RRRRR        RRRRR</span>    <span style="color:#3daee9">Icons:</span> Breeze
<span style="color:#3daee9">                          </span>    <span style="color:#3daee9">Terminal:</span> Konsole
<span style="color:#3daee9">                          </span>    <span style="color:#3daee9">CPU:</span> Virtual CPU @ 2.4GHz
<span style="color:#3daee9">                          </span>    <span style="color:#3daee9">Memory:</span> 4096MiB / 16384MiB

<span style="background:#e74c3c">   </span><span style="background:#f39c12">   </span><span style="background:#27ae60">   </span><span style="background:#3daee9">   </span><span style="background:#9b59b6">   </span><span style="background:#e91e63">   </span><span style="background:#fff">   </span><span style="background:#2c3e50">   </span>`,
                            screenfetch: () => commands.neofetch(),
                            lsb_release: () => args[0] === '-a' ? `Distributor ID: Runget
Description:    Runget 2.0 (Anythink Anywhere)
Release:        2.0
Codename:       anythink` : 'lsb_release: use -a for all info',
                            free: () => `              total        used        free      shared  buff/cache   available
Mem:       16384000     4096000    10240000      512000     2048000    11776000
Swap:       8192000           0     8192000`,
                            df: () => `Filesystem     1K-blocks     Used Available Use% Mounted on
/dev/sda1      524288000 125829120 398458880  24% /
tmpfs            8192000        0   8192000   0% /dev/shm`,
                            uptime: () => `${new Date().toLocaleTimeString('ru-RU')} up ${Math.floor(performance.now()/60000)} min, 1 user, load average: 0.15, 0.10, 0.05`,
                            ps: () => `  PID TTY          TIME CMD
    1 ?        00:00:01 systemd
  256 ?        00:00:00 plasmashell
  312 pts/0    00:00:00 konsole
  315 pts/0    00:00:00 bash`
                        };
                        const result = commands[command] ? commands[command]() : `${command}: command not found`;
                        if (result) history.push(result);
                    }
                    updateOutput(); input.value = '';
                }
            };
            setTimeout(() => input.focus(), 100);
        }

        // Kate Editor
        function openKate(file) {
            const winId = createWindow({
                title: file ? file.name + ' — Kate' : 'Untitled — Kate', icon: 'fa-file-code', width: 750, height: 520,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="this.closest('.window-content').querySelector('textarea').value=''"><i class="fas fa-file"></i> Новый</button>
                        <button class="kde-btn" onclick="const t=this.closest('.window-content').querySelector('textarea').value;const b=new Blob([t],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='document.txt';a.click();showNotification('Файл сохранён','success')"><i class="fas fa-save"></i> Сохранить</button>
                    </div>
                    <textarea style="width:100%;height:calc(100% - 46px);background:#1a1d21;color:var(--plasma-text);border:none;padding:16px;font-family:monospace;font-size:13px;resize:none;outline:none">${file?.content || ''}</textarea>
                `, appId: 'kate'
            });
        }

        // System Settings
        function openSettings() {
            const winId = createWindow({
                title: 'Параметры системы', icon: 'fa-cog', width: 950, height: 650,
                content: '', appId: 'settings'
            });
            
            function renderSettings() {
                const contentEl = document.querySelector(`#window-${winId} .window-content`);
                if (!contentEl) return;
                contentEl.innerHTML = `
                    <div style="display:flex;height:100%">
                        <div class="settings-sidebar">
                            <div class="settings-section">
                                <div class="settings-section-title">Внешний вид</div>
                                <div class="settings-item active"><i class="fas fa-image"></i> Обои</div>
                            </div>
                            <div class="settings-section">
                                <div class="settings-section-title">Система</div>
                                <div class="settings-item" onclick="openApp('info')"><i class="fas fa-info-circle"></i> О системе</div>
                            </div>
                        </div>
                        <div class="settings-content">
                            <h2 class="settings-title">Обои рабочего стола</h2>
                            <p style="color:var(--plasma-text-secondary);margin-bottom:20px">Выберите градиент для рабочего стола</p>
                            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px" id="wallpaperGrid"></div>
                        </div>
                    </div>
                `;
                
                const grid = document.getElementById('wallpaperGrid');
                wallpapers.forEach((w, i) => {
                    const item = document.createElement('div');
                    item.className = 'wallpaper-item';
                    item.style.cssText = `border-radius:10px;overflow:hidden;cursor:pointer;border:3px solid ${Runget.settings.wallpaper === i ? 'var(--plasma-accent)' : 'transparent'};transition:all 0.2s`;
                    item.innerHTML = `
                        <div style="height:80px;background:${w.gradient}"></div>
                        <div style="padding:8px 10px;background:var(--plasma-surface);color:var(--plasma-text);font-size:11px;text-align:center">${w.name}</div>
                    `;
                    item.onclick = function() {
                        Runget.settings.wallpaper = i;
                        applyWallpaper();
                        document.querySelectorAll('#wallpaperGrid .wallpaper-item').forEach(el => {
                            el.style.borderColor = 'transparent';
                        });
                        this.style.borderColor = 'var(--plasma-accent)';
                        showNotification(`Обои изменены: ${w.name}`, 'success');
                    };
                    grid.appendChild(item);
                });
            }
            
            renderSettings();
        }

        // System Info
        function openSystemInfo() {
            createWindow({
                title: 'О системе', icon: 'fa-info-circle', width: 600, height: 580,
                content: `
                    <div style="padding:30px;overflow-y:auto;height:100%">
                        <div class="about-logo">
                            <span class="logo-3d-r" style="font-size:80px">R</span>
                            <div class="about-title">Runget 2.0</div>
                            <div class="about-subtitle">"Anythink Anywhere"</div>
                        </div>
                        <div class="about-info">
                            <div class="about-row"><span class="about-label">Версия</span><span class="about-value">${Runget.version}</span></div>
                            <div class="about-row"><span class="about-label">Кодовое имя</span><span class="about-value">${Runget.codename}</span></div>
                            <div class="about-row"><span class="about-label">Ядро</span><span class="about-value">${Runget.kernel}</span></div>
                            <div class="about-row"><span class="about-label">Рабочий стол</span><span class="about-value">${Runget.desktop}</span></div>
                            <div class="about-row"><span class="about-label">Основа</span><span class="about-value">${Runget.based}</span></div>
                        </div>
                        <div class="about-info">
                            <div class="about-row"><span class="about-label">Разработчики</span><span class="about-value">Kolyadual, Kirilldual, Seregaosm, Neeby</span></div>
                            <div class="about-row"><span class="about-label">Telegram</span><span class="about-value"><a href="https://t.me/runget_rt" style="color:var(--plasma-accent)">@runget_rt</a></span></div>
                            <div class="about-row"><span class="about-label">Email</span><span class="about-value">runget.feedback@gmail.com</span></div>
                        </div>
                        <p style="color:var(--plasma-text-secondary);font-size:12px;text-align:center">© 2025 Kolyadual and Runget team</p>
                    </div>
                `, appId: 'info'
            });
        }

        // Calculator
        function openCalculator() {
            let display = '0', prev = null, op = null, waitOp = false;
            const winId = createWindow({ title: 'Калькулятор', icon: 'fa-calculator', width: 320, height: 440, content: '', appId: 'calculator' });
            
            function render() {
                return `
                    <div style="padding:16px;background:var(--plasma-bg);height:100%">
                        <div style="background:var(--plasma-surface);padding:20px;border-radius:8px;text-align:right;font-size:32px;color:var(--plasma-text);margin-bottom:16px;min-height:60px" id="calcDisplay">${display}</div>
                        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
                            ${['C','±','%','÷','7','8','9','×','4','5','6','-','1','2','3','+','0','.','⌫','='].map(b => {
                                let bg = 'rgba(255,255,255,0.06)';
                                if (['÷','×','-','+','='].includes(b)) bg = 'var(--plasma-accent)';
                                if (['C','±','%'].includes(b)) bg = 'rgba(255,255,255,0.12)';
                                return `<button style="padding:16px;border:none;border-radius:8px;font-size:18px;cursor:pointer;background:${bg};color:var(--plasma-text)" onclick="window.__calc('${b}')">${b}</button>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.querySelector(`#window-${winId} .window-content`).innerHTML = render();
            
            window.__calc = (b) => {
                const dispEl = document.getElementById('calcDisplay');
                if (!dispEl) return;
                if (b >= '0' && b <= '9' || b === '.') { display = waitOp ? b : (display === '0' && b !== '.' ? b : display + b); waitOp = false; }
                else if (['+','-','×','÷'].includes(b)) { if (op && !waitOp) calculate(); prev = parseFloat(display); op = b; waitOp = true; }
                else if (b === '=') { calculate(); op = null; }
                else if (b === 'C') { display = '0'; prev = null; op = null; }
                else if (b === '±') { display = String(-parseFloat(display)); }
                else if (b === '%') { display = String(parseFloat(display) / 100); }
                else if (b === '⌫') { display = display.length > 1 ? display.slice(0, -1) : '0'; }
                dispEl.textContent = display;
            };
            
            function calculate() {
                const cur = parseFloat(display);
                let r = cur;
                if (op === '+') r = prev + cur;
                else if (op === '-') r = prev - cur;
                else if (op === '×') r = prev * cur;
                else if (op === '÷') r = cur !== 0 ? prev / cur : 'Err';
                display = String(typeof r === 'number' ? Math.round(r * 1e10) / 1e10 : r);
                waitOp = true;
            }
        }

        // Calendar
        function openCalendar() {
            const now = new Date();
            const month = now.getMonth(), year = now.getFullYear(), today = now.getDate();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const months = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
            
            let days = [];
            for (let i = 0; i < (firstDay || 7) - 1; i++) days.push('');
            for (let i = 1; i <= daysInMonth; i++) days.push(i);
            
            createWindow({
                title: 'Календарь', icon: 'fa-calendar-alt', width: 380, height: 420,
                content: `
                    <div style="padding:20px;background:var(--plasma-bg);height:100%">
                        <div style="text-align:center;margin-bottom:20px;color:var(--plasma-text);font-size:20px">${months[month]} ${year}</div>
                        <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;text-align:center">
                            ${['Пн','Вт','Ср','Чт','Пт','Сб','Вс'].map(d => `<div style="color:var(--plasma-text-secondary);font-size:12px;padding:8px">${d}</div>`).join('')}
                            ${days.map(d => `<div style="padding:10px;border-radius:8px;color:var(--plasma-text);${d === today ? 'background:var(--plasma-accent);font-weight:600' : ''}">${d}</div>`).join('')}
                        </div>
                    </div>
                `, appId: 'calendar'
            });
        }

        // Weather via AccuWeather
        function openWeather() {
            createWindow({
                title: 'Погода — AccuWeather', icon: 'fa-cloud-sun', width: 900, height: 600,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="this.closest('.window-content').querySelector('iframe').src=this.closest('.window-content').querySelector('iframe').src"><i class="fas fa-redo"></i> Обновить</button>
                        <span style="flex:1"></span>
                        <button class="kde-btn" onclick="window.open('https://www.accuweather.com/','_blank')"><i class="fas fa-external-link-alt"></i> Открыть в браузере</button>
                    </div>
                    <iframe src="https://www.accuweather.com/" style="width:100%;height:calc(100% - 46px);border:none;background:#fff"></iframe>
                `,
                appId: 'weather'
            });
        }

        // System Monitor
        function openSystemMonitor() {
            createWindow({
                title: 'Системный монитор', icon: 'fa-chart-area', width: 600, height: 400,
                content: `
                    <div style="padding:20px;background:var(--plasma-bg);height:100%">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
                            ${[{name:'CPU',val:'23%',color:'#3daee9',w:23},{name:'RAM',val:'4.2/16 GB',color:'#27ae60',w:26},{name:'Диск',val:'120/500 GB',color:'#f39c12',w:24},{name:'Swap',val:'0/8 GB',color:'#9b59b6',w:0}].map(x => `
                                <div style="background:var(--plasma-surface);padding:16px;border-radius:10px">
                                    <div style="display:flex;justify-content:space-between;margin-bottom:10px">
                                        <span style="color:var(--plasma-text-secondary)">${x.name}</span>
                                        <span style="color:var(--plasma-text)">${x.val}</span>
                                    </div>
                                    <div style="height:6px;background:var(--plasma-bg);border-radius:3px">
                                        <div style="width:${x.w}%;height:100%;background:${x.color};border-radius:3px"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `, appId: 'monitor'
            });
        }

        // Gwenview
        function openGwenview() {
            createWindow({
                title: 'Gwenview', icon: 'fa-image', width: 650, height: 480,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="document.getElementById('imgInput').click()"><i class="fas fa-folder-open"></i> Открыть</button>
                        <input type="file" id="imgInput" accept="image/*" style="display:none" onchange="const f=this.files[0];if(f){const r=new FileReader();r.onload=e=>document.getElementById('imgPreview').innerHTML='<img src=\\''+e.target.result+'\\' style=\\'max-width:100%;max-height:100%\\'>';r.readAsDataURL(f)}">
                    </div>
                    <div id="imgPreview" style="height:calc(100% - 46px);display:flex;align-items:center;justify-content:center;background:var(--plasma-bg);color:var(--plasma-text-secondary)">
                        <div style="text-align:center"><i class="fas fa-image" style="font-size:64px;opacity:0.3;display:block;margin-bottom:16px"></i>Откройте изображение</div>
                    </div>
                `, appId: 'gwenview'
            });
        }

        // Elisa
        function openElisa() {
            createWindow({
                title: 'Elisa', icon: 'fa-music', width: 480, height: 380,
                content: `
                    <div style="padding:30px;background:linear-gradient(135deg,#8e24aa,#5e35b1);height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:white">
                        <div style="width:120px;height:120px;background:rgba(255,255,255,0.15);border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:20px">
                            <i class="fas fa-music" style="font-size:50px"></i>
                        </div>
                        <div style="font-size:20px;margin-bottom:6px">Демо трек</div>
                        <div style="opacity:0.7;margin-bottom:20px">Runget Music</div>
                        <div style="width:100%;max-width:280px;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;margin-bottom:20px">
                            <div style="width:35%;height:100%;background:white;border-radius:2px"></div>
                        </div>
                        <div style="display:flex;gap:20px">
                            <button style="background:none;border:none;color:white;font-size:20px;cursor:pointer"><i class="fas fa-step-backward"></i></button>
                            <button style="width:50px;height:50px;border-radius:50%;background:white;border:none;color:#8e24aa;font-size:20px;cursor:pointer"><i class="fas fa-play"></i></button>
                            <button style="background:none;border:none;color:white;font-size:20px;cursor:pointer"><i class="fas fa-step-forward"></i></button>
                        </div>
                    </div>
                `, appId: 'elisa'
            });
        }

        // Okular
        function openOkular() {
            createWindow({
                title: 'Okular', icon: 'fa-file-pdf', width: 650, height: 520,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn" onclick="document.getElementById('pdfInput').click()"><i class="fas fa-folder-open"></i> Открыть</button>
                        <input type="file" id="pdfInput" accept=".pdf" style="display:none" onchange="if(this.files[0])document.getElementById('pdfFrame').src=URL.createObjectURL(this.files[0])">
                    </div>
                    <iframe id="pdfFrame" style="width:100%;height:calc(100% - 46px);border:none;background:#525659"></iframe>
                `, appId: 'okular'
            });
        }

        // Krita
        function openKrita() {
            const winId = createWindow({
                title: 'Krita', icon: 'fa-paint-brush', width: 850, height: 580,
                content: `
                    <div class="kde-toolbar">
                        <input type="color" id="paintColor" value="#ffffff" style="width:36px;height:30px;border:none;border-radius:4px;cursor:pointer">
                        <input type="range" id="paintSize" min="1" max="50" value="5" style="width:100px">
                        <span style="color:var(--plasma-text);font-size:12px" id="paintSizeLabel">5px</span>
                        <button class="kde-btn" onclick="window.__clearCanvas()"><i class="fas fa-trash"></i> Очистить</button>
                        <button class="kde-btn" onclick="window.__saveCanvas()"><i class="fas fa-save"></i> Сохранить</button>
                    </div>
                    <canvas id="paintCanvas" style="cursor:crosshair;display:block"></canvas>
                `, appId: 'krita'
            });
            
            setTimeout(() => {
                const canvas = document.getElementById('paintCanvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 848; canvas.height = 488;
                ctx.fillStyle = '#1b1e20'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                let drawing = false, lastX = 0, lastY = 0;
                canvas.onmousedown = (e) => { drawing = true; [lastX, lastY] = [e.offsetX, e.offsetY]; };
                canvas.onmousemove = (e) => {
                    if (!drawing) return;
                    ctx.beginPath();
                    ctx.strokeStyle = document.getElementById('paintColor').value;
                    ctx.lineWidth = document.getElementById('paintSize').value;
                    ctx.lineCap = 'round';
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                    [lastX, lastY] = [e.offsetX, e.offsetY];
                };
                canvas.onmouseup = canvas.onmouseleave = () => drawing = false;
                document.getElementById('paintSize').oninput = (e) => document.getElementById('paintSizeLabel').textContent = e.target.value + 'px';
                window.__clearCanvas = () => { ctx.fillStyle = '#1b1e20'; ctx.fillRect(0, 0, canvas.width, canvas.height); };
                window.__saveCanvas = () => { const a = document.createElement('a'); a.href = canvas.toDataURL(); a.download = 'artwork.png'; a.click(); showNotification('Сохранено!', 'success'); };
            }, 50);
        }

        // LibreOffice
        function openLibreOffice() {
            createWindow({
                title: 'LibreOffice Writer', icon: 'fa-file-word', width: 800, height: 550,
                content: `
                    <div class="kde-toolbar">
                        <button class="kde-btn"><i class="fas fa-bold"></i></button>
                        <button class="kde-btn"><i class="fas fa-italic"></i></button>
                        <button class="kde-btn"><i class="fas fa-underline"></i></button>
                        <span style="flex:1"></span>
                        <button class="kde-btn" onclick="const t=this.closest('.window-content').querySelector('[contenteditable]').innerText;const b=new Blob([t],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='document.txt';a.click()"><i class="fas fa-save"></i> Сохранить</button>
                    </div>
                    <div contenteditable="true" style="padding:40px;background:white;color:#333;height:calc(100% - 46px);overflow:auto;font-family:serif;outline:none">
                        <h1>Добро пожаловать в LibreOffice Writer</h1>
                        <p>Начните вводить текст здесь...</p>
                    </div>
                `, appId: 'libreoffice'
            });
        }

        // Tasks
        function openTasks() {
            let tasks = JSON.parse(localStorage.getItem('runget-tasks') || '[]');
            const winId = createWindow({ title: 'Задачи', icon: 'fa-tasks', width: 450, height: 480, content: '', appId: 'tasks' });
            
            function render() {
                return `
                    <div style="padding:20px;background:var(--plasma-bg);height:100%">
                        <div style="display:flex;gap:10px;margin-bottom:20px">
                            <input class="kde-input" style="flex:1" id="taskInput" placeholder="Новая задача...">
                            <button class="kde-btn" onclick="window.__addTask()"><i class="fas fa-plus"></i></button>
                        </div>
                        <div id="tasksList">
                            ${tasks.map((t, i) => `
                                <div style="display:flex;align-items:center;gap:12px;padding:12px;background:var(--plasma-surface);border-radius:8px;margin-bottom:8px">
                                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="window.__toggleTask(${i})" style="width:18px;height:18px">
                                    <span style="flex:1;color:var(--plasma-text);${t.done ? 'text-decoration:line-through;opacity:0.5' : ''}">${t.text}</span>
                                    <button style="background:none;border:none;color:var(--plasma-danger);cursor:pointer" onclick="window.__removeTask(${i})"><i class="fas fa-trash"></i></button>
                                </div>
                            `).join('') || '<div style="text-align:center;color:var(--plasma-text-secondary);padding:40px">Нет задач</div>'}
                        </div>
                    </div>
                `;
            }
            
            document.querySelector(`#window-${winId} .window-content`).innerHTML = render();
            const save = () => localStorage.setItem('runget-tasks', JSON.stringify(tasks));
            const refresh = () => document.querySelector(`#window-${winId} .window-content`).innerHTML = render();
            
            window.__addTask = () => { const input = document.getElementById('taskInput'); if (input.value.trim()) { tasks.push({ text: input.value.trim(), done: false }); save(); refresh(); } };
            window.__toggleTask = (i) => { tasks[i].done = !tasks[i].done; save(); refresh(); };
            window.__removeTask = (i) => { tasks.splice(i, 1); save(); refresh(); };
        }

        // Notes
        function openNotes() {
            const notes = localStorage.getItem('runget-notes') || '';
            createWindow({
                title: 'Заметки', icon: 'fa-sticky-note', width: 400, height: 400,
                content: `
                    <textarea style="width:100%;height:100%;background:var(--plasma-bg);color:var(--plasma-text);border:none;padding:16px;resize:none;outline:none;font-size:14px" 
                              placeholder="Введите заметки..."
                              oninput="localStorage.setItem('runget-notes',this.value)">${notes}</textarea>
                `, appId: 'notes'
            });
        }

        // Clock
        function openClock() {
            const winId = createWindow({ title: 'Часы', icon: 'fa-clock', width: 350, height: 400, content: '', appId: 'clock' });
            
            function update() {
                const now = new Date();
                const h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
                const el = document.querySelector(`#window-${winId} .window-content`);
                if (!el) return;
                el.innerHTML = `
                    <div style="padding:30px;text-align:center;background:var(--plasma-bg);height:100%">
                        <div style="font-size:48px;color:var(--plasma-text);font-weight:300;margin-bottom:10px">${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}</div>
                        <div style="color:var(--plasma-text-secondary);margin-bottom:30px">${now.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' })}</div>
                        <svg width="180" height="180" viewBox="0 0 200 200">
                            <circle cx="100" cy="100" r="95" fill="none" stroke="var(--plasma-border)" stroke-width="4"/>
                            ${[...Array(12)].map((_, i) => `<line x1="100" y1="15" x2="100" y2="25" stroke="var(--plasma-text)" stroke-width="2" transform="rotate(${i*30} 100 100)"/>`).join('')}
                            <line x1="100" y1="100" x2="100" y2="45" stroke="var(--plasma-text)" stroke-width="4" stroke-linecap="round" transform="rotate(${(h%12)*30 + m/2} 100 100)"/>
                            <line x1="100" y1="100" x2="100" y2="30" stroke="var(--plasma-text)" stroke-width="3" stroke-linecap="round" transform="rotate(${m*6} 100 100)"/>
                            <line x1="100" y1="100" x2="100" y2="25" stroke="var(--plasma-accent)" stroke-width="2" stroke-linecap="round" transform="rotate(${s*6} 100 100)"/>
                            <circle cx="100" cy="100" r="6" fill="var(--plasma-accent)"/>
                        </svg>
                    </div>
                `;
            }
            update();
            const interval = setInterval(update, 1000);
        }

        // ==================== GAMES ====================
        
        // Snake
        function openSnake() {
            const winId = createWindow({ title: 'Змейка', icon: 'fa-gamepad', width: 440, height: 520, content: `
                <div class="game-container">
                    <div class="game-info"><span class="game-score"><i class="fas fa-star"></i> <span id="snakeScore">0</span></span><button class="kde-btn" onclick="window.__startSnake()"><i class="fas fa-play"></i> Старт</button></div>
                    <canvas id="snakeCanvas" class="game-canvas" width="400" height="400"></canvas>
                    <div style="color:var(--plasma-text-secondary);font-size:12px;margin-top:10px">Стрелки для управления</div>
                </div>
            `, appId: 'snake' });
            
            const canvas = document.getElementById('snakeCanvas');
            const ctx = canvas.getContext('2d');
            let snake, food, dir, score, loop;
            
            function init() { snake = [{x:10,y:10}]; dir = {x:1,y:0}; score = 0; placeFood(); document.getElementById('snakeScore').textContent = score; }
            function placeFood() { food = { x: Math.floor(Math.random() * 20), y: Math.floor(Math.random() * 20) }; }
            function draw() {
                ctx.fillStyle = '#1a1a2e'; ctx.fillRect(0, 0, 400, 400);
                snake.forEach((s, i) => { ctx.fillStyle = i === 0 ? '#27ae60' : '#2ecc71'; ctx.fillRect(s.x * 20 + 1, s.y * 20 + 1, 18, 18); });
                ctx.fillStyle = '#e74c3c'; ctx.beginPath(); ctx.arc(food.x * 20 + 10, food.y * 20 + 10, 8, 0, Math.PI * 2); ctx.fill();
            }
            function update() {
                const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
                if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(s => s.x === head.x && s.y === head.y)) {
                    clearInterval(loop); showNotification(`Игра окончена! Счёт: ${score}`, 'info'); return;
                }
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) { score++; document.getElementById('snakeScore').textContent = score; placeFood(); }
                else snake.pop();
                draw();
            }
            
            document.addEventListener('keydown', (e) => {
                const dirs = { ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0} };
                if (dirs[e.key] && (dirs[e.key].x !== -dir.x || dirs[e.key].y !== -dir.y)) { e.preventDefault(); dir = dirs[e.key]; }
            });
            
            window.__startSnake = () => { clearInterval(loop); init(); draw(); loop = setInterval(update, 100); };
            init(); draw();
        }

        // Tetris
        function openTetris() {
            const winId = createWindow({ title: 'Тетрис', icon: 'fa-th', width: 360, height: 520, content: `
                <div class="game-container">
                    <div class="game-info"><span class="game-score"><i class="fas fa-star"></i> <span id="tetrisScore">0</span></span><button class="kde-btn" onclick="window.__startTetris()"><i class="fas fa-play"></i> Старт</button></div>
                    <canvas id="tetrisCanvas" class="game-canvas" width="200" height="400"></canvas>
                </div>
            `, appId: 'tetris' });
            
            const canvas = document.getElementById('tetrisCanvas');
            const ctx = canvas.getContext('2d');
            const cols = 10, rows = 20, size = 20;
            const shapes = [[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];
            const colors = ['#00f0f0','#f0f000','#a000f0','#f0a000','#0000f0','#00f000','#f00000'];
            let board, piece, pieceX, pieceY, pieceType, score, loop;
            
            function init() { board = Array(rows).fill().map(() => Array(cols).fill(0)); score = 0; newPiece(); document.getElementById('tetrisScore').textContent = score; }
            function newPiece() { pieceType = Math.floor(Math.random() * shapes.length); piece = shapes[pieceType]; pieceX = Math.floor(cols / 2) - 1; pieceY = 0; if (collision()) { clearInterval(loop); showNotification(`Игра окончена! Счёт: ${score}`, 'info'); } }
            function collision() { for (let y = 0; y < piece.length; y++) for (let x = 0; x < piece[y].length; x++) if (piece[y][x] && (board[pieceY + y]?.[pieceX + x] !== 0 || pieceX + x < 0 || pieceX + x >= cols || pieceY + y >= rows)) return true; return false; }
            function merge() { for (let y = 0; y < piece.length; y++) for (let x = 0; x < piece[y].length; x++) if (piece[y][x]) board[pieceY + y][pieceX + x] = pieceType + 1; }
            function clearLines() { for (let y = rows - 1; y >= 0; y--) if (board[y].every(c => c)) { board.splice(y, 1); board.unshift(Array(cols).fill(0)); score += 100; y++; } document.getElementById('tetrisScore').textContent = score; }
            function rotate() { const rotated = piece[0].map((_, i) => piece.map(r => r[i]).reverse()); const old = piece; piece = rotated; if (collision()) piece = old; }
            function draw() {
                ctx.fillStyle = '#1a1a2e'; ctx.fillRect(0, 0, 200, 400);
                for (let y = 0; y < rows; y++) for (let x = 0; x < cols; x++) if (board[y][x]) { ctx.fillStyle = colors[board[y][x] - 1]; ctx.fillRect(x * size + 1, y * size + 1, size - 2, size - 2); }
                ctx.fillStyle = colors[pieceType];
                for (let y = 0; y < piece.length; y++) for (let x = 0; x < piece[y].length; x++) if (piece[y][x]) ctx.fillRect((pieceX + x) * size + 1, (pieceY + y) * size + 1, size - 2, size - 2);
            }
            function update() { pieceY++; if (collision()) { pieceY--; merge(); clearLines(); newPiece(); } draw(); }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') { pieceX--; if (collision()) pieceX++; }
                else if (e.key === 'ArrowRight') { pieceX++; if (collision()) pieceX--; }
                else if (e.key === 'ArrowDown') { pieceY++; if (collision()) pieceY--; }
                else if (e.key === 'ArrowUp') rotate();
                draw();
            });
            
            window.__startTetris = () => { clearInterval(loop); init(); draw(); loop = setInterval(update, 500); };
            init(); draw();
        }

        // Pong
        function openPong() {
            const winId = createWindow({ title: 'Пинг-понг', icon: 'fa-table-tennis', width: 520, height: 420, content: `
                <div class="game-container">
                    <div class="game-info"><span class="game-score"><span id="pongScore1">0</span> : <span id="pongScore2">0</span></span><button class="kde-btn" onclick="window.__startPong()"><i class="fas fa-play"></i> Старт</button></div>
                    <canvas id="pongCanvas" class="game-canvas" width="480" height="320"></canvas>
                </div>
            `, appId: 'pong' });
            
            const canvas = document.getElementById('pongCanvas');
            const ctx = canvas.getContext('2d');
            let ball, p1, p2, score1, score2, loop;
            
            function init() { ball = {x:240,y:160,vx:4,vy:2}; p1 = p2 = 130; score1 = score2 = 0; updateScore(); }
            function updateScore() { document.getElementById('pongScore1').textContent = score1; document.getElementById('pongScore2').textContent = score2; }
            function draw() {
                ctx.fillStyle = '#1a1a2e'; ctx.fillRect(0, 0, 480, 320);
                ctx.fillStyle = '#fff';
                ctx.fillRect(10, p1, 10, 60);
                ctx.fillRect(460, p2, 10, 60);
                ctx.beginPath(); ctx.arc(ball.x, ball.y, 8, 0, Math.PI * 2); ctx.fill();
                ctx.setLineDash([5, 5]); ctx.beginPath(); ctx.moveTo(240, 0); ctx.lineTo(240, 320); ctx.strokeStyle = '#444'; ctx.stroke(); ctx.setLineDash([]);
            }
            function update() {
                ball.x += ball.vx; ball.y += ball.vy;
                if (ball.y <= 8 || ball.y >= 312) ball.vy = -ball.vy;
                if (ball.x <= 28 && ball.y >= p1 && ball.y <= p1 + 60) ball.vx = -ball.vx;
                if (ball.x >= 452 && ball.y >= p2 && ball.y <= p2 + 60) ball.vx = -ball.vx;
                if (ball.x < 0) { score2++; updateScore(); ball = {x:240,y:160,vx:4,vy:2}; }
                if (ball.x > 480) { score1++; updateScore(); ball = {x:240,y:160,vx:-4,vy:2}; }
                // AI
                if (p2 + 30 < ball.y) p2 = Math.min(260, p2 + 3);
                if (p2 + 30 > ball.y) p2 = Math.max(0, p2 - 3);
                draw();
            }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp') p1 = Math.max(0, p1 - 20);
                if (e.key === 'ArrowDown') p1 = Math.min(260, p1 + 20);
            });
            
            window.__startPong = () => { clearInterval(loop); init(); draw(); loop = setInterval(update, 16); };
            init(); draw();
        }

        // 2048
        function open2048() {
            const winId = createWindow({ title: '2048', icon: 'fa-th-large', width: 400, height: 480, content: '', appId: 'game2048' });
            let grid, score;
            
            function init() { grid = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]; score = 0; addTile(); addTile(); }
            function addTile() { const empty = []; for (let y = 0; y < 4; y++) for (let x = 0; x < 4; x++) if (!grid[y][x]) empty.push({x, y}); if (empty.length) { const {x, y} = empty[Math.floor(Math.random() * empty.length)]; grid[y][x] = Math.random() < 0.9 ? 2 : 4; } }
            function getColor(v) { const c = {0:'#3d4349',2:'#eee4da',4:'#ede0c8',8:'#f2b179',16:'#f59563',32:'#f67c5f',64:'#f65e3b',128:'#edcf72',256:'#edcc61',512:'#edc850',1024:'#edc53f',2048:'#edc22e'}; return c[v] || '#3c3a32'; }
            function render() {
                const el = document.querySelector(`#window-${winId} .window-content`);
                if (!el) return;
                el.innerHTML = `
                    <div style="padding:20px;background:var(--plasma-bg);height:100%">
                        <div style="display:flex;justify-content:space-between;margin-bottom:15px">
                            <span style="color:var(--plasma-text);font-size:18px">Счёт: ${score}</span>
                            <button class="kde-btn" onclick="window.__start2048()"><i class="fas fa-redo"></i></button>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;background:var(--plasma-surface);padding:8px;border-radius:8px">
                            ${grid.flat().map(v => `<div style="height:70px;display:flex;align-items:center;justify-content:center;background:${getColor(v)};border-radius:6px;font-size:24px;font-weight:bold;color:${v > 4 ? '#fff' : '#776e65'}">${v || ''}</div>`).join('')}
                        </div>
                        <div style="color:var(--plasma-text-secondary);font-size:12px;margin-top:15px;text-align:center">Стрелки для управления</div>
                    </div>
                `;
            }
            function move(dir) {
                let moved = false;
                const rotate = (g) => g[0].map((_, i) => g.map(r => r[i]).reverse());
                for (let i = 0; i < dir; i++) grid = rotate(grid);
                for (let y = 0; y < 4; y++) {
                    let row = grid[y].filter(v => v);
                    for (let i = 0; i < row.length - 1; i++) if (row[i] === row[i + 1]) { row[i] *= 2; score += row[i]; row.splice(i + 1, 1); }
                    while (row.length < 4) row.push(0);
                    if (row.join(',') !== grid[y].join(',')) moved = true;
                    grid[y] = row;
                }
                for (let i = 0; i < (4 - dir) % 4; i++) grid = rotate(grid);
                if (moved) addTile();
                render();
            }
            
            document.addEventListener('keydown', (e) => {
                const dirs = { ArrowLeft: 0, ArrowUp: 1, ArrowRight: 2, ArrowDown: 3 };
                if (dirs[e.key] !== undefined) { e.preventDefault(); move(dirs[e.key]); }
            });
            
            window.__start2048 = () => { init(); render(); };
            init(); render();
        }

        // Minesweeper
        function openMinesweeper() {
            const winId = createWindow({ title: 'Сапёр', icon: 'fa-bomb', width: 350, height: 420, content: '', appId: 'minesweeper' });
            const size = 10, mines = 15;
            let grid, revealed, flags, gameOver;
            
            function init() {
                grid = Array(size).fill().map(() => Array(size).fill(0));
                revealed = Array(size).fill().map(() => Array(size).fill(false));
                flags = Array(size).fill().map(() => Array(size).fill(false));
                gameOver = false;
                let placed = 0;
                while (placed < mines) {
                    const x = Math.floor(Math.random() * size), y = Math.floor(Math.random() * size);
                    if (grid[y][x] !== -1) { grid[y][x] = -1; placed++; }
                }
                for (let y = 0; y < size; y++) for (let x = 0; x < size; x++) if (grid[y][x] !== -1) {
                    let count = 0;
                    for (let dy = -1; dy <= 1; dy++) for (let dx = -1; dx <= 1; dx++) if (grid[y + dy]?.[x + dx] === -1) count++;
                    grid[y][x] = count;
                }
            }
            function reveal(x, y) {
                if (gameOver || revealed[y][x] || flags[y][x]) return;
                revealed[y][x] = true;
                if (grid[y][x] === -1) { gameOver = true; showNotification('Вы проиграли!', 'error'); }
                else if (grid[y][x] === 0) for (let dy = -1; dy <= 1; dy++) for (let dx = -1; dx <= 1; dx++) if (grid[y + dy]?.[x + dx] !== undefined) reveal(x + dx, y + dy);
                render();
            }
            function flag(x, y, e) { e.preventDefault(); if (!revealed[y][x]) { flags[y][x] = !flags[y][x]; render(); } }
            function render() {
                const colors = ['','#3daee9','#27ae60','#e74c3c','#9b59b6','#f39c12','#1abc9c','#34495e','#95a5a6'];
                const el = document.querySelector(`#window-${winId} .window-content`);
                if (!el) return;
                el.innerHTML = `
                    <div style="padding:15px;background:var(--plasma-bg);height:100%">
                        <div style="display:flex;justify-content:space-between;margin-bottom:10px">
                            <span style="color:var(--plasma-text)"><i class="fas fa-bomb"></i> ${mines}</span>
                            <button class="kde-btn" onclick="window.__startMine()"><i class="fas fa-redo"></i></button>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(${size},1fr);gap:2px">
                            ${grid.flat().map((v, i) => {
                                const x = i % size, y = Math.floor(i / size);
                                let content = '', bg = 'var(--plasma-surface)';
                                if (revealed[y][x]) { bg = 'var(--plasma-bg)'; content = v === -1 ? '<i class="fas fa-bomb"></i>' : v || ''; }
                                else if (flags[y][x]) content = '<i class="fas fa-flag" style="color:#e74c3c"></i>';
                                return `<div onclick="window.__revealMine(${x},${y})" oncontextmenu="window.__flagMine(${x},${y},event)" style="height:28px;display:flex;align-items:center;justify-content:center;background:${bg};border-radius:3px;cursor:pointer;font-size:12px;font-weight:bold;color:${colors[v] || '#fff'}">${content}</div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            window.__startMine = () => { init(); render(); };
            window.__revealMine = reveal;
            window.__flagMine = flag;
            init(); render();
        }

        // Tic Tac Toe
        function openTicTacToe() {
            const winId = createWindow({ title: 'Крестики-нолики', icon: 'fa-times', width: 350, height: 400, content: '', appId: 'tictactoe' });
            let board, turn, gameOver;
            
            function init() { board = ['','','','','','','','','']; turn = 'X'; gameOver = false; }
            function check() {
                const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
                for (const [a, b, c] of wins) if (board[a] && board[a] === board[b] && board[a] === board[c]) return board[a];
                return board.every(c => c) ? 'draw' : null;
            }
            function play(i) {
                if (gameOver || board[i]) return;
                board[i] = turn;
                const result = check();
                if (result) { gameOver = true; showNotification(result === 'draw' ? 'Ничья!' : `${result} победил!`, 'info'); }
                else turn = turn === 'X' ? 'O' : 'X';
                render();
            }
            function render() {
                const el = document.querySelector(`#window-${winId} .window-content`);
                if (!el) return;
                el.innerHTML = `
                    <div style="padding:20px;background:var(--plasma-bg);height:100%;display:flex;flex-direction:column;align-items:center">
                        <div style="margin-bottom:15px;color:var(--plasma-text)">Ход: ${turn}</div>
                        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:15px">
                            ${board.map((v, i) => `<div onclick="window.__playTTT(${i})" style="width:80px;height:80px;display:flex;align-items:center;justify-content:center;background:var(--plasma-surface);border-radius:8px;cursor:pointer;font-size:36px;font-weight:bold;color:${v === 'X' ? '#3daee9' : '#e74c3c'}">${v}</div>`).join('')}
                        </div>
                        <button class="kde-btn" onclick="window.__startTTT()"><i class="fas fa-redo"></i> Заново</button>
                    </div>
                `;
            }
            
            window.__startTTT = () => { init(); render(); };
            window.__playTTT = play;
            init(); render();
        }

        // Start boot
        boot();
    </script>
</body>
</html>
